#-*- org -*-
TODO tasks for ASEP

* questions for heidi
**  front office vs instructor signup sheet differences?
* formatting
** the rest of the reports (like, 20 of them)!
* ui
**	deposit form
		either auto-enter or a button to auto enter automatically
			any checks to OSSPTO
			which are joint checks
			or which are for classes which are minimum
		show popup of the next one when entering
			or my summary might be OK, using echosen
			popup would be fun though.
		put in check number, autocomplete
			populate the info on the check
		will need some kind of undepposited status, total amount
** company checks
      pick which checks are delivered!
	  they are by class, which is how she files them
	  classinfo/_income
	  a checkbox, mark all, save, would be fine
**	check_income
*** make multi-entry form work for EDITING too
	now the saving
	create, student id provided
	create, nothing provided
*** multi-form: should auto-javascript calculate totals applied and check them
***     checks/_income: if user chooses student, constrain classes based on unpaid
**	validation and data entry error checking/warning
*** ajax validation via yii built in -- errors
****   	[#A] the student must be signed up for that class before it gets paid
		look up the keys, see that there's something there
		extend http://www.yiiframework.com/doc/api/CExistValidator ?
****    [#B] a check or split where totals exceed check
		make sure the incomes are not more or less than the total check
		it's probably ok if the incomes are LESS than total check tho
****    instructor percentages don't exceed 100%
*** trapping sql/fk errors through ajax validation
****    trying to delete things that have foreign keys
	 in check, for sure, but also everywhere really
****    change company name with instructors who are not in that company
****    duplicate key, unique validators, dupe checking! for all records really
		all the linktables! it'll have to check key combos
		first/last in student
		class meeting/class_id unique
		school day in calendar
*** js validation via yii built in
	first make sure that the notice works, addNotice, i hope
****     entering to a session not the current default
*** ajax validation via yii built in -- warnings/notice
****    class over capacity but student set to enrolled
****    change the day of week but there are active meetings
*** not sure where
***		how?
               populate a js array with the data, and check it that way?
**	in general, make menu on views like checkincome (just edit and delete)
		and maybe add ones for the others, the tab ones
**  class/_income: show checks with unpaid balance
	calculate, and show a picklist, with their associated remaining balance
	let the user pick them to assign, instead of new check
* bugfixen
**	[#A] in class/_owed, should include waitlisted!
		checks do get entered, gets put in another envelope
**	in paid, why are cancelleds payments not showing up at all?
**	on student/_income, if cancelled, show the paids,
		so find enrolled OR cancelled or just not waitlisted
**	they WERE paid. only returned checks shouldn't show up.
		or maybe they should, just not in totals?


** chozen does not like being provided with arrays from sql finds
   it makes the width of the box only as wide as teh FIRST item.
   i tried dataprovider but it did not help
* oh crap. how to deal with partial refunds???
	i.e. waitlist? or a cancellation of only ONE class, not all?
	or late refunds
	DO I NEED TO TRACK REFUND CHECKS?


	
* reports first! THEN DO THE UI AGAIN based on the reports. try that.
* general gui questions MUST get dealt with
	sorxting!
	searching!


* small ui things
** date/time conversions
		do it in the load_model method!
		and before save in update/create.
		that is all. no problems, no muss, no fuss.
**	finish putting datepickers in
		check expense
		check income
		deposit
		schoolcalendar
		expensse
		income


* gui conundrums wrapped in enigmas
**	clean up date and weekday formatting, using formatter in yii
		not my zhtml hack
		but beware the afterfind/beforevalidate crap!
			it could break my model start/end stuff VERY IMPORTANT!
			do it by overloading load_model and beforevalidate, instead
			BE CAREFUL!
		i could create a separate get/set that wraps it
			for every model that has dates in it. gah.
			or a wrapper that transforms them before/after manually
**	payments -> deposits
		i'll really need a pick list here!
		will need to pick the checks AT THE SAME TIME as entering
		of all payments not yet assigned to a deposit.
		how to move them to and fro?
		deposits MUST calculate out too
			there's a whole lot of reconciling that needs to go on here.
		will need a picklist of checks-not-yet-deposited
			this could be VERY easy.
			by default, a new deposit should have all of them.
	how to handle teachers who are students?
		reflextitve relation. dammit. they're not teachers of THIS
	checks get returned, she said, if they're waitlisted
		
* CLEANUP
** vital
***	trap exceptions on save,  if there's an integrity constraint!
		trap/catch errors when trying to delete linked tables
***	also trap exceptions on double-delete, it happens in ajax-land
		if the refresh isn't complete yet
***	go through and make sure all my queries and searches are session-enabled
		so i can change them later easily
        this means the popups too.
        default sort/scope for everytbing
        search and such
***	add an EMPTY as a default for deposit on checks!	
***	use wide layout with menu at top from roster for ALL things
		it needs to be integrated into class for sure, and student
        this is in roster, in main branch
		i also have it in a branch menuthrash. works with clips, nice!
***	use either breadcrumbs or returnto, but be consistent!
		breadcrumbs is cleaner than returnto, but will it work?
** useful
*** go through all the multi-link _forms, put <div row> before the issset
***	redo the unpaid thing, this is ridiculous
		 do this stupidity in sql
				 class
				 cost - income.amount for this student and class
			 where this student,
				 and the cost - paid is > 0!
			 sort by payee
         link for new check, or assign existing check (unassigned)
	     choose existing check as option in unpaid
		 an autocomplete with lists of checks with amounts still avail on them
*** make session dropdown disabled css by default, checkbox to change
***	manually edit dates, in m/d/y format
*** add  the returnto for zhtml::clickablerow
	it's already in there for composite keys, but i need to add it for the other one
***	today button, fix
*** user login, password admin, use the database, not useridentity.php!
*** add date validator
*** allow multiple requirements, i.e contracts for several years
	remove unique key constraint
	in status, i'll need MAX() queries instead of AR stuff
***	make search work with booleans/checkboxes
*** make search work with linktables!
***	make sort work with linked subviews
		 not so easy
***	make company id 1  not editable or removable (company form/view)
***	autocompletes not dropdowns
		students
		classes
		roster import
*** make date pickers have longer terms for some things (meetings, paperwork)
***	trap exception on populate for school days
*** clean up massive sql queries and translate them into cdbcriteria
	so i can have searches and sorts, also sums and totals!
***	to avoid confusion, special case the company stuff with js
		if company is not PTO, or is type company, show delivered, not deposited
			else  show deposited, not delivered
		if instructor type is company, show the company popup
			else hide company popup
		if is not company, don't show company popup at all
		javascript in forms, something else in view
***	new on pulldowns!! so new instructor at end of pulldown for instructor
***	now make the save() actions check breadcrumbs, not returnto
** cosmetic
***	use the roster as the template for any index views, i have the css nice
***	a nice jui popup when hovering over a cell, showing description!
***	year bump buttons on the expired and received datepickers
		didn't i do that already?
***	signupsheet
		strikethrough for cancelled
		color/gray for waitlist?
***	dependent date/timepickers, i.e. start/end intelligently
***	the goddamned times are wrong, they're not in am/pm time! they don't convert
		this is the timepicker brokenness, fix it
***	generate the signup form via PDF library, on the fly	

* STUCK
** open questions
***	how do you know who to write the check to (from that report)?
***	deleting/cancelling a class
***	returning a check! do you just delete it?
***	cost PER class? extra costs? total cost? how?
***	will you have a case where the materials fee is NOT PER CLASS
		i.e. per year?


** student payment status, i.e. enrollment with payment status
** ok, forms starting to make sense
	for adding a check from student or class, DO NOT NEED TO SPLIT IT
		hell, i alredy know the student, class, AND amount! 
		just a single line, try cform builder!
		and, i can not bother with a popup for check
		hell, i can have an ajax popup for splits.
			make that form optional for create, but NOT optional for editing
	for adding payment through class or instructor, do NOT probably need it.
		ask heidi about that one tho. maybe redirect for now.
	for adding check through checks, put a tabular input!
		keep it simple. js to add/remove rows.
	for adding a payment through checks, will need tabular input
	for adding a STUDENT to a class, just do one form with both models!
		what if the students are already in there? it's just a signup.
			most will be.
			if not, then an entry?
* FUTURE REQUIRD
** must have for NEXT SESSION!
***	for setting session, for now, just a simple non-ajax screen, nothing fancy
		then i have to start using it in queries. named scope, seems right.
		the big issue will be all the dropdowns, which use findAll()
			i should start constraining those by session!
			use named scope, it's easy, default scope is session now!
		searches also, need to use the named scope or something
***	how to import/add new class from previous session
		an ajaxything or something, a popup
		relational deep copy! only a few tables though:
		 	instructors, it'll need to create new joins for them. just them!
			and extra fees
			not students though. until parents sign them up! or income.
***	delete a class
		first fix the link, it's not a-werken (missing js?)
		only delete class is no students signed up
		do not let them delete otherwise
		DO automatically delete all the dates and instructors
		delete from instructor_assignment where class_id=:cid
		delete from class_meeting where class_id=:cid
		delete from class_info where id=:cid



** must have for NEXT YEAR:
***	need some way to track the current school year. 
		yes, i remember now!!!! it took today's date, calculated month!
		so based on where you were in the calendar, you were this year or next
		aha, i think it will be a named scope
***	picklist of STUDENTS could get huge, and need to be pared down
		how to determine when kids are no longer in ocean shore??
		um, graduate them? when updating grades, if grade > 8, remove
		current flag?
		also, grade needs to be updated every year somehow
***	i will DEFINITELY need some kind of de-duping system
		like i had to do for the coop. it'll have to happen.



* FOR NON-ADMIN USER LOGIN
** future/with user login security
	let instructors edit descriptions
		


* BELOW THE LINE
** maybe make location a link column, not let them be in same place

** try editable datatable!
	go back and replace many_many and advanced with has_many and with-related
		requirementtype
		instructortype

** make a validation rule to make sure that the instructors aren't getting > 100 % !!
	i.e. check to see if a class has > 100% total

	in the some popup (chosen?), the # is breaking stuff
		i decided not to use it, so this is below the line for now

** have a checkbox on income page to select which classes to pay

** visual show/add meeting dates
	a very quick datepicker adder!
	just a date, not hidden, and boom, it adds, maybe even ajaxy.
	in the meetingdates, join to school calendar and show that stuff!
		
**	new student wizard really. ajaxy: class->student->import->signup

** finish the relational mappings
***	a way to create/edit/save a dependent model with ONE field in relation
		or a FEW maybe
		use tom__'s stuff i think
		a common pattern, for a few important things
			income
			expense
			signup
			instructorassignmeent
			requirementstatus
***	gui splits for income/expense
		for now handle it like instructors
			but the data entry would be way too complicated that way
		

**	autoppopulate the check when adding
		when adding well, i guess, when adding subthings
